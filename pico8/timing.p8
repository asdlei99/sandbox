pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

-- the function to test
--function test(n) memset(0, 17, n) end
function test(i,j)
  --memset(0, 0x20, i)
  --rectfill(32,32,32+i,32+j,3)
  circ(64,64,i,4)
  circ(64,64,i,5)
  circ(64,64,i,6)
  circ(64,64,i,7)
  circ(64,64,i,8)
  circ(64,64,i,9)
  circ(64,64,i,10)
  circ(64,64,i,11)
  circ(64,64,i,12)
  circ(64,64,i,13)
end
--function test(n) for i=1,n do poke4(i, 1745.5489) end end
--function test(n) for i=1,n do poke(i, 17) end end
--[[function test(n)
  local x = (k/2+rnd(k/2))/16
  local y = n/x/256
  map(0, 0, 0, 0, x, x)
end]]--
--function test(n) x=flr(sqrt(n))/16 map(0, 0, 0, 0, 6, 6) end

function empty(i,j) end

function _init()
  ready = false
  time_total, time_system = 0, 0
  cls()
  stats_total = {}
  stats_system = {}
end

function benchmark()
  local iter = 0
  local total, system = stat(1), stat(2)
  local new_total, new_system
  local i = ((rnd(128)))
  local j = (sqrt(rnd(128*128)))
  local n = i
  local mult = 10
  local fn = ready and test or empty
  repeat
    --for k=1,mult do fn(i,j) end
    fn(i,j) fn(i,j) fn(i,j) fn(i,j) fn(i,j)
    fn(i,j) fn(i,j) fn(i,j) fn(i,j) fn(i,j)
    new_total, new_system = stat(1), stat(2)
    iter += 1
  until iter > 5
  --until new_total > 0.5
  local d1 = (new_total - total) * 100 / (iter * mult)
  local d2 = (new_system - system) * 100 / (iter * mult)
  if ready then
    d1 -= time_total
    d2 -= time_system
    stats_total[n], stats_system[n] = d1, d2
    printh(n.." "..d1.." "..d2.."")
  else
    time_total = d1
    time_system = d2
  end
  ready = not ready
end

function _update60()
  benchmark()
end

function _draw()
end

__gfx__
00000000000999092222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099990092000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700999090092022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000909900902022020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000900900900222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700909900900022220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000900990900002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000900000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002000101000000000000020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002000001000000020201010001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002020001010202000001000101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020202010101000001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000202000000000000020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000200020200020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020000000202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020002020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020202000202020101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000020001020101010202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001010100000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001020200000000020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
